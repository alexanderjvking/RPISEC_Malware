Malware Analysis
Lab 03 - Analyzing Windows Programs

3-1

1)Did you find any interesting resources? If so, how did you extract it?
	I found a resouce dll file using filealyzer

2) List at least 3 imports. What is their purpose and how might the malware 
use them?
	a) Createfile - The Malware is able to create some type of file
	b) writefile - Malware can write to existing files to add more malware
			or logging
	c) Loadresource - Gives the ability to load ddl info

3) List at least 3 strings that stick out to you and how they might relate to 
malicous activity?
	a) regsvr32 /s C:\Windows\atidrv.dll - could be the file that is created
	   used to be some type of cover
	b) C:\Users\IEUser\Downloads\BHOinCPP_src\BHOinCPP\Release\launch.pdb -
	   runs BHOinCPP a browser helper object from code projects
	c) http://rpis.ec - could be a host signature

4) What persistence mechanism is used by this malware? What host-based 
signatures cat you gather from this?
	It unpacks and creates a new dll then registers it with regsrv

	CLSID\\{3543619C-D563-43f7-95EA-4DA7E1CC396A}\\InProcServer3
	Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Browser Helper Objects\\
	{3543619C-D563-43f7-95EA-4DA7E1CC396A}CodeProject Example BHO


5) What is the CLSID served by this malware?
	CLSID{3543619C-D563-43f7-95EA-4DA7E1CC396A}

6) What is the name of the COM interface that this malware makes use of?
	IWebBrowser2

7) What two COM functions does this malware call from the above COM interface
and what are they used for?
	0xa4 - put_Visible opens window
	0x2c - Navigate shows the url in browser
	brings ups rpisecs blogs

3-2
1) What is the md5sum? What does VirusTotal report?
	md5 -BF4F5B4FF7ED9C7275496C07F9836028
	sha-1 - d1bfc02db9922f89da0cef14b514b63af3703f1ab7bd88d558431151bfac92e2
	Seems to be some Trojan or Dark hotel variant (spear phishing)

2) List 3 imports you haven't seen before
	a) GetLogicalDrives - Retrieves a bitmask representing the currently available disk drives.
	b) GetSystemDirectoryA - Retrieves the path of the system directory. The system directory 
	   contains system files such as dynamic-link libraries and drivers.
	c) htons - The htons function converts a u_short from host to TCP/IP network byte order
	   (which is big-endian).

3) List at least 3 strings that stick out to you
	a) \\java.exe - some file that might be created for persistance.
	b) SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run - registry keys cause programs to 
	   run each time that a user logs on
	c) C:\\DOCUME~1\ - A folder that may be created.

4) what persistence mechanism is used by this malware? What host-based
   signatures can you gather from this?
	The Key is set in SOFTWARE\Microsoft\Windows\CurrentVersion\Run then copies
	itself to C:\\DOCUME~1\User\java.exe The host based signatures are the 
	location of java.exe

Identified functionality
	list processes, interactive remote shell, upload file (from infected machine)

5) What is the address of the subroutine that handles this functionality?
	List processes - sub_402310
	Remote Shell - sub_402490 sub_402660
	upload file - sub_402210

6) What is the command ID?
	List process - 0x7
	Remote shell - 0x9 0x10
	upload file - 0x6

7) Does the subroutine return anything to the attacker, if so, what?
	List process -	Creates a list of processes xors with 0x55 and sends to
			the attacker.
	Remote shell -	0x402490 opens cmd.exe and 0x402660 sends a command to cmd.exe
			reads the named pipe and sends the result back.
	upload file -	Creates a file mapping into memory xor with 0x55 and sends 
			file to attacker.

8) Name 3 Windows API calls used and how the contribute to the functionality?
	List processes - CreateToolhelp32Snapshot(takes a view of process), Process32First(finds first), 
	         Process32Next (moves to next process)
	Remote Shell - CreateProcessA (creates a process), PeekNamedPipe(makes pipe), ReadFile (reads a file)
	upload file - CreateFileA (creates a file to write to), CreateFileMappingA
		      (creates/ opens file), send(sends file to remote server)

9) Did the networking guys miss anything? name 3 more functionalities offered by the
   malware. Provide command IDs
	GetSystemDirectoryA - Gets current directory 0x2
	
, 